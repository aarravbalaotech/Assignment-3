<!DOCTYPE html>
<html>
  <head>
    <title>Dashboard - Student Finance Helper</title>
    <link rel='stylesheet' href='/Content/app.css' />
    <link rel="stylesheet" href="/bootstrap/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="/@fortawesome/fontawesome-free/css/all.min.css">
    <script src="/jquery/dist/jquery.min.js"></script>
    <script src="/bootstrap/dist/js/bootstrap.min.js"></script>
  </head>
  <body>
    <%- include('./partials/main_nav') %>
    
    <div class="dashboard-container">
      <div class="container">
        <div class="dashboard-header">
          <h1><i class="fas fa-chart-line"></i> Dashboard</h1>
          <p>Welcome back, <strong><%= displayName %></strong>! Here's your financial overview.</p>
        </div>

        <div class="row mb-4">
          <div class="col-md-6 col-lg-3">
            <a href="/budgets" class="text-decoration-none text-reset">
              <div class="summary-card">
                <div class="summary-card-icon" style="color: #3498db;">
                  <i class="fas fa-wallet"></i>
                </div>
                <div class="summary-card-value"><%= budgetCount %></div>
                <div class="summary-card-label">Active Budgets</div>
                <div class="small text-muted mt-1">Total: $<%= (typeof totalBudgetAmount !== 'undefined' ? (totalBudgetAmount||0).toFixed(2) : '0.00') %></div>
              </div>
            </a>
          </div>

          <div class="col-md-6 col-lg-3">
            <a href="/expenses" class="text-decoration-none text-reset">
              <div class="summary-card">
                <div class="summary-card-icon" style="color: #e74c3c;">
                  <i class="fas fa-credit-card"></i>
                </div>
                <div class="summary-card-value">$<%= (typeof totalExpenses !== 'undefined' ? (totalExpenses||0).toFixed(2) : '0.00') %></div>
                <div class="summary-card-label">Total Expenses</div>
                <div class="small text-muted mt-1">Last 5 shown below</div>
              </div>
            </a>
          </div>

          <div class="col-md-6 col-lg-3">
            <a href="/goals" class="text-decoration-none text-reset">
              <div class="summary-card">
                <div class="summary-card-icon" style="color: #27ae60;">
                  <i class="fas fa-target"></i>
                </div>
                <div class="summary-card-value"><%= goalCount %></div>
                <div class="summary-card-label">Savings Goals</div>
                <div class="small text-muted mt-1">Saved: $<%= (typeof budgets !== 'undefined' && typeof goals !== 'undefined' ? (goals.reduce((s,g)=>s+(parseFloat(g.currentAmount)||0),0)).toFixed(2) : '0.00') %></div>
              </div>
            </a>
          </div>

          <div class="col-md-6 col-lg-3">
            <a href="/goals" class="text-decoration-none text-reset">
              <div class="summary-card">
                <div class="summary-card-icon" style="color: #16a085;">
                  <i class="fas fa-chart-pie"></i>
                </div>
                <div class="summary-card-value"><%= progressPercentage %>%</div>
                <div class="summary-card-label">Goal Progress</div>
                <div class="small text-muted mt-1">Overall progress across goals</div>
              </div>
            </a>
          </div>
        </div>

        <div class="row">
          <div class="col-lg-6">
            <div class="card">
              <div class="card-header">
                <i class="fas fa-wallet"></i> Quick Actions
              </div>
              <div class="card-body">
                <a href="/budgets" class="btn btn-primary btn-block mb-2">
                  <i class="fas fa-plus"></i> Manage Budgets
                </a>
                <a href="/expenses" class="btn btn-danger btn-block mb-2">
                  <i class="fas fa-plus"></i> Log Expense
                </a>
                <a href="/goals" class="btn btn-success btn-block">
                  <i class="fas fa-plus"></i> Create Goal
                </a>
              </div>
            </div>
          </div>

          <div class="col-lg-6">
            <div class="card">
              <div class="card-header">
                <i class="fas fa-info-circle"></i> Tips & Info
              </div>
              <div class="card-body">
                <ul class="list-unstyled">
                  <li class="mb-2">
                    <strong><i class="fas fa-check" style="color: #27ae60;"></i> Budgets:</strong> Set spending limits for different categories.
                  </li>
                  <li class="mb-2">
                    <strong><i class="fas fa-check" style="color: #27ae60;"></i> Expenses:</strong> Track every dollar you spend.
                  </li>
                  <li>
                    <strong><i class="fas fa-check" style="color: #27ae60;"></i> Goals:</strong> Save for your future with achievable targets.
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </div>

        <div class="row mt-4">
          <div class="col-lg-6">
            <div class="card">
              <div class="card-header">
                <i class="fas fa-clock"></i> Recent Expenses
              </div>
              <div class="card-body">
                <% if(typeof expenses !== 'undefined' && expenses && expenses.length) { %>
                  <div class="table-responsive">
                    <table class="table table-sm">
                      <thead>
                        <tr>
                          <th>Description</th>
                          <th class="text-end">Amount</th>
                        </tr>
                      </thead>
                      <tbody>
                        <% expenses.slice().reverse().slice(0,5).forEach(function(e){ %>
                          <tr>
                            <td><%= e.title %> <small class="text-muted">(<%= new Date(e.date).toLocaleDateString() %>)</small></td>
                            <td class="text-end">$<%= (parseFloat(e.amount)||0).toFixed(2) %></td>
                          </tr>
                        <% }); %>
                      </tbody>
                    </table>
                  </div>
                <% } else { %>
                  <p class="text-muted">No recent expenses. Use "Log Expense" to add one.</p>
                <% } %>
              </div>
            </div>
          </div>

          <div class="col-lg-6">
            <div class="card">
              <div class="card-header">
                <i class="fas fa-bullseye"></i> Goals Progress
              </div>
              <div class="card-body">
                <% if(typeof goals !== 'undefined' && goals && goals.length) { %>
                  <% goals.forEach(function(goal){ 
                      var target = parseFloat(goal.targetAmount) || 0;
                      var current = parseFloat(goal.currentAmount) || 0;
                      var pct = target>0 ? Math.min(100, Math.round((current/target)*100)) : 0;
                  %>
                    <div class="mb-3">
                      <div class="d-flex justify-content-between">
                        <div><strong><%= goal.title %></strong></div>
                        <div><span class="badge bg-secondary"><%= pct %>%</span></div>
                      </div>
                      <div class="progress mt-2" style="height: 10px;">
                        <div class="progress-bar" role="progressbar" style="width: <%= pct %>%;"></div>
                      </div>
                      <div class="small text-muted mt-1">Saved $<%= current.toFixed(2) %> of $<%= target.toFixed(2) %></div>
                    </div>
                  <% }); %>
                <% } else { %>
                  <p class="text-muted">No goals yet. Create a goal to start saving.</p>
                <% } %>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <%- include('./partials/footer') %>
  </body>
</html>